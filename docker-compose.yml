version: '2'
services:
  megafuse:
    environment: 
      - PASSPHRASE
      - VOLSIZE
      - OLDERTHAN
      - TZ
      - RESTOREDPATH
    hostname: ${HOSTNAME}
    privileged: true
    build:
      context: .
      dockerfile: Dockerfile
#      args:
#       - MOUNTPOINT=${MOUNTPOINT}
#    image: dublicity_megafuse
    volumes:
      - ./.env:/root/megafuse.conf:ro
#      - /home/porky/.gnupg:/root/.gnupg:ro
      - ./cache:/root/.cache/duplicity:rw
      - ./configs:/root/configs:ro
      - $RESTOREDPATH:/root/megarestored:rw
      - /:/hostdisk:ro
#      - /etc/localtime:/etc/localtime:ro
#      - /etc/timezone:/etc/timezone:ro
    dns:
      - 169.254.1.3
    stdin_open: true
    tty: true
    container_name: megafuse
    #command:  /bin/mkdir ${MOUNTPOINT}; MegaFuse -c /root/megafuse.conf
    command: MegaFuse -c /root/megafuse.conf
    command:  >
      sh -c "ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && 
      echo $TZ > /etc/timezone &&
      exec MegaFuse -c /root/megafuse.conf"
    restart: always
#sudo docker-compose -f docker-compose.yml up -d
#      dpkg-reconfigure -f noninteractive tzdata &&
